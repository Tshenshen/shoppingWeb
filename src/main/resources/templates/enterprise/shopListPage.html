<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>我的店铺</title>
    <script th:src="@{/js/jquery-3.4.1.js}"></script>
    <script th:src="@{/webjars/vue/2.6.11/dist/vue.js}"></script>
    <script th:src="@{/webjars/element-ui/2.13.0/lib/index.js}"></script>
    <script src="" th:src="@{/js/bootstrap.js}"></script>
    <script src="" th:src="@{/js/axios.min.js}"></script>
    <link th:href="@{/webjars/element-ui/2.13.0/lib/theme-chalk/index.css}" rel="stylesheet">
    <link href="" rel="stylesheet" th:href="@{/css/bootstrap.css}">
    <link href="" rel="stylesheet" th:href="@{/css/enterprise/shopListPage.css}">
</head>
<body>
<div th:replace="toolBar/topNavBar::topNavBar"></div>
<div id="app" style="width: 85% ; margin: auto">
    <el-container>
        <el-header>
            <h1 style="color: red;text-align: center">我的店铺<i class="el-icon-s-shop"></i></h1>
        </el-header>
        <el-main>
            <div class="shop left-order" v-for="(shop,index) in shopList" :key="index">
                <div class="shop-image left-order">
                    <el-image :src="shopImg(shop.images)">
                        <div slot="error" class="image-slot shop-image-error">
                            请到编辑页面中添加图片
                        </div>
                    </el-image>
                </div>
                <div class="shop-right left-order">
                    <div class="shop-title">
                        {{shop.shopName}}
                    </div>
                    <div class="shop-edit">
                        <div class="shop-edit-info left-order">
                            <el-link type="primary" icon="el-icon-edit">店铺信息</el-link>
                            <!--todo 加链接-->
                        </div>
                        <div class="shop-edit-page left-order">
                            <el-link type="primary" icon="el-icon-edit">店铺页面</el-link>
                        </div>
                    </div>
                    <div class="shop-edit">
                        <div class="shop-enable left-order">
                            <el-switch
                                    v-model="shop.enable"
                                    active-text="启用店铺"
                                    active-value="1"
                                    inactive-value="0"
                                    @change="updateShopEnable(index)">
                            </el-switch>
                        </div>
                        <div class="shop-delete left-order">
                            <el-link type="danger" icon="el-icon-delete" @click="deleteShopById(index)">删除</el-link>
                        </div>

                    </div>
                </div>
            </div>
            <!--<div class="shop left-order">-->
            <!--<div class="shop-image left-order">-->
            <!--<el-image th:src="@{/image/1.jpg}"></el-image>-->
            <!--</div>-->
            <!--<div class="shop-right left-order">-->
            <!--<div class="shop-title">-->
            <!--撒旦法撒旦法阿斯蒂芬阿萨德撒旦法撒旦法阿斯蒂芬阿萨德撒旦法撒旦法阿斯蒂芬阿萨德撒旦法撒旦法阿斯蒂芬阿萨德萨德撒旦法撒旦法阿斯蒂芬阿萨德-->
            <!--</div>-->
            <!--<div class="shop-edit">-->
            <!--<div class="shop-edit-info left-order">-->
            <!--<el-link type="primary" icon="el-icon-edit">店铺信息</el-link>-->
            <!--</div>-->
            <!--<div class="shop-edit-page left-order">-->
            <!--<el-link type="primary" icon="el-icon-edit">店铺页面</el-link>-->
            <!--</div>-->
            <!--</div>-->
            <!--<div class="shop-edit">-->
            <!--<div class="shop-enable left-order">-->
            <!--<el-switch-->
            <!--v-model="value1"-->
            <!--active-text="启用店铺"-->
            <!--active-value="1"-->
            <!--inactive-value="0">-->
            <!--</el-switch>-->
            <!--</div>-->
            <!--<div class="shop-delete left-order">-->
            <!--<el-link type="danger" icon="el-icon-delete">删除</el-link>-->
            <!--</div>-->

            <!--</div>-->
            <!--</div>-->
            <!--</div>-->
            <div class="shop left-order">
                <div class="shop-create left-order">
                    <el-link type="primary" icon="el-icon-plus" @click="createShopDialogVisible = true">添加新店铺</el-link>
                </div>
            </div>

            <el-dialog title="添加新店铺" :visible.sync="createShopDialogVisible">
                <el-form :model="createShopForm" :rules="rules" ref="createShopFormRef">
                    <el-form-item label="店铺名（商品名）" prop="shopName">
                        <el-input v-model="createShopForm.shopName" autocomplete="off"></el-input>
                    </el-form-item>
                    <el-form-item label="商品种类" prop="type">
                        <el-select v-model="createShopForm.type" filterable placeholder="请选择商品种类" @change="getStyleDic">
                            <el-option
                                    v-for="type in typeDic"
                                    :key="type.id"
                                    :label="type.name"
                                    :value="type.value">
                            </el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="商品类型" prop="style">
                        <el-select v-model="createShopForm.style" filterable placeholder="请选择商品类型">
                            <el-option
                                    v-for="style in styleDic"
                                    :key="style.id"
                                    :label="style.name"
                                    :value="style.value">
                            </el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="价格区间" prop="price">
                        <el-input v-model="createShopForm.price" autocomplete="off"></el-input>
                    </el-form-item>
                    <el-form-item label="商品描述" prop="describe">
                        <el-input type="textarea" v-model="createShopForm.describe" autocomplete="off"></el-input>
                    </el-form-item>
                </el-form>
                <div slot="footer" class="dialog-footer">
                    <el-button @click="createShopDialogVisible = false">取 消</el-button>
                    <el-button type="primary" @click="submitCreateShopForm">确 定</el-button>
                </div>
            </el-dialog>
        </el-main>
    </el-container>


</div>
</div>
</body>
<script th:src="@{/js/toolBar/topNavBar.js}"></script>
<script>
    new Vue({
        el: "#app",
        data: {
            createShopDialogVisible: false,
            createShopForm: {
                type: '',
                style: ''
            },
            rules: {
                shopName: [
                    {required: true, message: "请输入店铺/商品名", trigger: 'blur'}
                ],
                type: [
                    {required: true, message: "请选择商品种类", trigger: 'blur'}
                ],
                style: [
                    {required: true, message: "请选择商品类型", trigger: 'blur'}
                ],
                price: [
                    {required: true, message: "请输入商品价格区间", trigger: 'blur'}
                ],
                describe: [
                    {required: true, message: "请输入商品描述", trigger: 'blur'}
                ]
            },
            typeDic: [],
            styleDic: [],
            shopList: []
        },
        mounted() {
            var _that = this;
            axios.get("getMyShopList").then(function (value) {
                if (value.data.success) {
                    _that.shopList = value.data.content;
                } else {
                    _that.$message.error(value.data.message);
                }
            }).catch(function (reason) {
                console.log(reason);
                _that.$message.error("获取种类错误！")
            })
            axios.get("/ShopWeb/dictionary/getAllType").then(function (value) {
                if (value.data.success) {
                    _that.typeDic = value.data.content;
                } else {
                    _that.$message.error(value.data.message);
                }
            }).catch(function (reason) {
                console.log(reason);
                _that.$message.error("获取种类错误！")
            })
        },
        computed: {
            shopImg() {
                return function (images) {
                    return images.split(",")[0];
                }
            }
        },
        methods: {
            submitCreateShopForm() {
                var _that = this;
                _that.$refs.createShopFormRef.validate(function (isValid) {
                    if (isValid) {
                        _that.createShopDialogVisible = false;
                        axios({
                            method: "post",
                            url: "createNewShop",
                            data: _that.createShopForm
                        }).then(function (value) {
                            if (value.data.success) {
                                _that.shopList.push(value.data.content);
                                _that.$message.success(value.data.message);
                            } else {
                                _that.$message.error(value.data.message);
                            }
                        }).catch(function (reason) {
                            console.log(reason);
                            _that.$message.error("新建店铺错误！")
                        })
                    } else {
                        _that.$message.error("请完善表单！")
                    }
                })
            },
            getStyleDic() {
                var _that = this;
                _that.createShopForm.style = '';
                axios({
                    method: "get",
                    url: "/ShopWeb/dictionary/getAllStyleByParentValue",
                    params: {
                        value: _that.createShopForm.type
                    }
                }).then(function (value) {
                    if (value.data.success) {
                        _that.styleDic = value.data.content;
                    } else {
                        _that.$message.error(value.data.message);
                    }
                }).catch(function (reason) {
                    console.log(reason);
                    _that.$message.error("获取类型错误！")
                })
            },
            deleteShopById(index) {
                var _that = this;
                _that.$confirm('是否确认删除?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(function () {
                    axios({
                        method: "delete",
                        url: "deleteShopById/" + _that.shopList[index].id
                    }).then(function (value) {
                        if (value.data.success) {
                            _that.shopList.splice(index, 1);
                            _that.$message.success(value.data.message);
                        } else {
                            _that.$message.error(value.data.message);
                        }
                    }).catch(function (reason) {
                        console.log(reason);
                        _that.$message.error("删除店铺错误！")
                    })
                });

            },
            updateShopEnable(index) {
                var _that = this;
                axios({
                    method: "put",
                    url: "updateShopEnable",
                    data: {
                        id: _that.shopList[index].id,
                        enable: _that.shopList[index].enable
                    }
                }).then(function (value) {
                    if (value.data.success) {
                        _that.$message.success(value.data.message);
                    } else {
                        _that.$message.error(value.data.message);
                    }
                }).catch(function (reason) {
                    console.log(reason);
                    _that.$message.error("开启或关闭店铺错误！")
                })
            }
        }
    })
</script>
</html>